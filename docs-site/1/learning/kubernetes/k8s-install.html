<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Installing Kubernetes :: Caleb Carlson | Docs Site</title>
    <link rel="canonical" href="https://inf0rmatiker.github.io/docs-site/1/learning/kubernetes/k8s-install.html">
    <meta name="generator" content="Antora 3.1.4">
    <link rel="stylesheet" href="../../../../_/css/site.css">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://inf0rmatiker.github.io">Caleb Carlson | Docs Site</a>
      <button class="navbar-burger" aria-controls="topbar-nav" aria-expanded="false" aria-label="Toggle main menu">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://inf0rmatiker.github.io/">Home</a>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="docs-site" data-version="1">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <button class="nav-menu-toggle" aria-label="Toggle expand/collapse all" style="display: none"></button>
    <h3 class="title"><a href="../../index.html">Documentation</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../index.html">Overview</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Projects</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">VU Meter</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../projects/vu-meter/vu-meter.html">VU Meter</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">PC Exhaust</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../projects/pc-exhaust/pc-exhaust.html">PC Exhaust</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Learning</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Kubernetes</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="crds.html">CRDs</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="k8s-api-resources.html">Kubernetes Resources</a>
  </li>
  <li class="nav-item is-current-page" data-depth="3">
    <a class="nav-link" href="k8s-install.html">Kubernetes Install</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="kubectl.html">kubectl</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Lustre</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../lustre/benchmarks.html">Benchmarks</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../lustre/compiling-lustre.html">Compiling Lustre</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../lustre/development.html">Development</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../lustre/lustre-client.html">Lustre Client</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../lustre/lustre-server.html">Lustre Server</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../lustre/lustre-networking.html">Lustre Networking</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Linux</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Installs</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../linux/installs/rocky-install.html">Rocky Linux Install</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../linux/installs/opensuse-install.html">OpenSUSE Linux Install</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../linux/isos.html">ISOs</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../linux/rpms.html">RPMs</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../linux/tmux.html">Tmux</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../linux/user-management.html">User Management</a>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Networking</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../linux/networking/linux-networking.html">Linux</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../linux/networking/mpi.html">MPI</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../linux/networking/proxies.html">Proxies</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../linux/networking/rdma.html">RDMA Programming</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../linux/networking/socket_programming.html">Socket Programming</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../linux/networking/ssh.html">SSH</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Storage</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../linux/storage/benchmarks.html">Benchmarks</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../linux/storage/filesystems.html">Filesystems</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../linux/storage/drives.html">Drives</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../linux/vms/virtual-machines.html">Virtual Machines</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Docker</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../docker/multiarch-building.html">Multi-Architecture Builds</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../docker/nginx-webserver.html">Nginx Webserver</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../docker/registry-proxy.html">Registry Proxy</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../asciinema/asciinema.html">Asciinema</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../bmc-management/bmc-management.html">BMC Management</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Version Control</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../version-control/git/git.html">Git</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../version-control/github/github.html">GitHub</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Algorithms</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../algorithms/dynamic-programming.html">Dynamic Programming</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../algorithms/sliding-window.html">Sliding Window</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Machine Learning</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../machine-learning/benchmarks.html">Benchmarks</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../machine-learning/determinedai.html">Determined AI</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">REST APIs</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../rest-apis/api-security.html">Secure Development</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">InfiniBand</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../infiniband/infiniband.html">InfiniBand</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../infiniband/monitoring.html">Fabric Monitoring</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Languages</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">C</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../languages/c/getopt.html">Getopt</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../languages/cpp/cpp.html">C++</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../languages/cpp/arrays.html">Arrays</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../languages/cpp/branch_control.html">Branch Control</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../languages/cpp/classes.html">Classes</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../languages/cpp/compiling.html">Compiling and Executing</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../languages/cpp/development_environment.html">Development Environment</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../languages/cpp/error_handling.html">Error Handling</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../languages/cpp/functions.html">Functions</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../languages/cpp/input_streams.html">Input Streams</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../languages/cpp/macros.html">Macros</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../languages/cpp/pointers.html">Pointers</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../languages/cpp/references.html">References</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../languages/cpp/structures.html">Stuctures</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../languages/cpp/types.html">Types</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../languages/cpp/vectors.html">Vectors</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../languages/go/go.html">Go</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../slurm/slurm.html">Slurm</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">GPUs</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../gpus/gds.html">GPUDirect Storage</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../gpus/numa.html">NUMA</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../switch-management/switch-management.html">Switch Management</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../hpcm/hpcm.html">HPCM</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">todo</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../todo/todo.html">todo</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Documentation</span>
    <span class="version">1</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <div class="title"><a href="../../index.html">Documentation</a></div>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../../index.html">1</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../../index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../../index.html">Documentation</a></li>
    <li>Learning</li>
    <li>Kubernetes</li>
    <li><a href="k8s-install.html">Kubernetes Install</a></li>
  </ul>
</nav>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Installing Kubernetes</h1>
<div class="sect1">
<h2 id="_opensuse_leap_15_3"><a class="anchor" href="#_opensuse_leap_15_3"></a>OpenSUSE Leap 15.3</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Original documentation for how to install <code>kubeadm</code>: <a href="https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/install-kubeadm/" class="bare">https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/install-kubeadm/</a></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Open these ports on the firewall: <a href="https://kubernetes.io/docs/reference/ports-and-protocols/" class="bare">https://kubernetes.io/docs/reference/ports-and-protocols/</a></p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p><code>firewall-cmd --add-port=6443/tcp --permanent</code></p>
</li>
<li>
<p>Repeat for all required ports</p>
</li>
</ol>
</div>
</li>
<li>
<p>Install <code>conntrack</code>: <code>zypper install conntrack-tools</code></p>
</li>
<li>
<p>Install <code>socat</code>: <code>zypper install socat</code></p>
</li>
<li>
<p>Enable <code>ip_forward</code>: <code>echo 1 | sudo tee /proc/sys/net/ipv4/ip_forward</code></p>
<div class="ulist">
<ul>
<li>
<p>Follow this guide: <a href="https://kubernetes.io/docs/setup/production-environment/container-runtimes/#forwarding-ipv4-and-letting-iptables-see-bridged-traffic" class="bare">https://kubernetes.io/docs/setup/production-environment/container-runtimes/#forwarding-ipv4-and-letting-iptables-see-bridged-traffic</a></p>
</li>
</ul>
</div>
</li>
<li>
<p>Install <code>containerd</code> as the container runtime: Follow instructions on <a href="https://github.com/containerd/containerd/blob/main/docs/getting-started.md">containerd&#8217;s Getting Started page</a></p>
<div class="ulist">
<ul>
<li>
<p>Go get runc and CNI plugin files (see following steps)</p>
</li>
<li>
<p>Go get the <a href="https://github.com/containerd/containerd/releases">latest released containerd archive</a></p>
</li>
<li>
<p>Untar it to <code>/usr/local</code>: <code>tar Cxzvf /usr/local containerd-1.6.6-linux-amd64.tar.gz</code></p>
</li>
<li>
<p>Download <a href="https://github.com/containerd/containerd/blob/main/containerd.service">containerd.service</a> and copy it to <code>/usr/lib/systemd/system/containerd.service</code> (Official docs say to put it at <code>/usr/local/lib</code>, there&#8217;s nothing there and this won&#8217;t work. Put it in <code>/usr/lib/…</code>)</p>
</li>
<li>
<p>Launch systemd daemon for containerd:</p>
<div class="ulist">
<ul>
<li>
<p><code>systemctl daemon-reload</code></p>
</li>
<li>
<p><code>systemctl enable --now containerd</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>Get runc archive if you don&#8217;t already have it: <a href="https://github.com/opencontainers/runc/releases" class="bare">https://github.com/opencontainers/runc/releases</a></p>
</li>
<li>
<p>Install it: <code>install -m 755 runc.amd64 /usr/local/sbin/runc</code></p>
</li>
<li>
<p>Go get CNI plugins: <a href="https://github.com/containernetworking/plugins/releases" class="bare">https://github.com/containernetworking/plugins/releases</a>, and install them under <code>opt/cni/bin</code>:</p>
<div class="ulist">
<ul>
<li>
<p><code>mkdir -p /opt/cni/bin</code></p>
</li>
<li>
<p><code>tar Cxzvf /opt/cni/bin cni-plugins-linux-amd64-v1.1.1.tgz</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>Check it works by running <code>ctr --help</code></p>
</li>
<li>
<p>Generate default containerd daemon configuration: <code>containerd config default &gt; /etc/containerd/config.toml</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>Configure systemd as cgroup with runc:</p>
<div class="ulist">
<ul>
<li>
<p>Edit <code>/etc/containerd/config.toml</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-asciidoc hljs" data-lang="asciidoc">   [plugins."io.containerd.grpc.v1.cri".containerd.runtimes.runc]
       ...
       [plugins."io.containerd.grpc.v1.cri".containerd.runtimes.runc.options]
       SystemdCgroup = true</code></pre>
</div>
</div>
</li>
<li>
<p>Restart containerd: <code>sudo systemctl restart containerd</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>Install <code>kubeadm</code>: <a href="https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/install-kubeadm/" class="bare">https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/install-kubeadm/</a></p>
</li>
<li>
<p>Install <code>critcl</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash"> DOWNLOAD_DIR=/usr/local/bin
 sudo mkdir -p $DOWNLOAD_DIR
 VERSION="v1.24.2"
 wget https://github.com/kubernetes-sigs/cri-tools/releases/download/$VERSION/crictl-$VERSION-linux-amd64.tar.gz
 sudo tar zxvf crictl-$VERSION-linux-amd64.tar.gz -C /usr/local/bin
 rm -f crictl-$VERSION-linux-amd64.tar.gz</code></pre>
</div>
</div>
</li>
<li>
<p>Install <code>kubeadm</code>, <code>kubectl</code>, <code>kubelet</code></p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash"> RELEASE="$(curl -sSL https://dl.k8s.io/release/stable.txt)"`
 ARCH="amd64"
 cd $DOWNLOAD_DIR
 sudo curl -L --remote-name-all https://storage.googleapis.com/kubernetes-release/release/${RELEASE}/bin/linux/${ARCH}/{kubeadm,kubelet,kubectl}
 sudo chmod +x {kubeadm,kubelet,kubectl}
 RELEASE_VERSION="v0.4.0"
 curl -sSL "https://raw.githubusercontent.com/kubernetes/release/${RELEASE_VERSION}/cmd/kubepkg/templates/latest/deb/kubelet/lib/systemd/system/kubelet.service" | sed "s:/usr/bin:${DOWNLOAD_DIR}:g" | sudo tee /etc/systemd/system/kubelet.service
 sudo mkdir -p /etc/systemd/system/kubelet.service.d
 curl -sSL "https://raw.githubusercontent.com/kubernetes/release/${RELEASE_VERSION}/cmd/kubepkg/templates/latest/deb/kubeadm/10-kubeadm.conf" | sed "s:/usr/bin:${DOWNLOAD_DIR}:g" | sudo tee /etc/systemd/system/kubelet.service.d/10-kubeadm.conf</code></pre>
</div>
</div>
</li>
<li>
<p>Enable kubelet: <code>systemctl enable --now kubelet</code></p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">Your Kubernetes control-plane has initialized successfully!

To start using your cluster, you need to run the following as a regular user:

 mkdir -p $HOME/.kube
 sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
 sudo chown $(id -u):$(id -g) $HOME/.kube/config

Alternatively, if you are the root user, you can run:

 export KUBECONFIG=/etc/kubernetes/admin.conf</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>You should now deploy a pod network to the cluster.</p>
<div class="ulist">
<ul>
<li>
<p>Run <code>kubectl apply -f &lt;podnetwork&gt;.yaml</code> with one of the options listed at: <a href="https://kubernetes.io/docs/concepts/cluster-administration/addons/" class="bare">https://kubernetes.io/docs/concepts/cluster-administration/addons/</a></p>
</li>
</ul>
</div>
</li>
<li>
<p>Then you can join any number of worker nodes by running the following on each as <code>root</code>:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">kubeadm join 172.26.143.70:6443 --token oos4yr.46zwgo9mzqavckkx --discovery-token-ca-cert-hash sha256:2b725a2cda814b07ee07c9d704de5a5cc2451c746eeb5b32277ebe661b9a36e4</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_rocky_linux_9_5"><a class="anchor" href="#_rocky_linux_9_5"></a>Rocky Linux 9.5</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This example install will be on the <code>mawenzi</code> cluster, using <code>mawenzi-01</code> as the admin node.</p>
</div>
<div class="sect2">
<h3 id="_references"><a class="anchor" href="#_references"></a>References</h3>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.rockylinux.org/labs/kubernetes-the-hard-way/lab0-README/">Rocky: Kubernetes the Hard Way</a></p>
</li>
<li>
<p><a href="https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/">Kubernetes: Bootstrapping a cluster with kubeadm</a></p>
<div class="ulist">
<ul>
<li>
<p><a href="https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/install-kubeadm/">Installing kubeadm</a></p>
</li>
<li>
<p><a href="https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/create-cluster-kubeadm/">Create cluster with kubeadm</a></p>
</li>
<li>
<p><a href="https://kubernetes.io/docs/reference/config-api/kubeadm-config.v1beta4/">Kubeadm Configuration</a></p>
</li>
<li>
<p><a href="https://kubernetes.io/docs/tasks/administer-cluster/kubeadm/configure-cgroup-driver/">Configure cgroup driver</a></p>
</li>
</ul>
</div>
</li>
<li>
<p><a href="https://github.com/flannel-io/flannel">Flannel: README</a></p>
</li>
<li>
<p><a href="https://kubernetes.io/docs/concepts/overview/components/">Kubernetes: Components</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_prerequisites"><a class="anchor" href="#_prerequisites"></a>Prerequisites</h3>
<div class="paragraph">
<p>We&#8217;ll start by preparing things for the control-plane node.</p>
</div>
<div class="paragraph">
<p>We&#8217;ll need to decide on a private CIDR subnet to use for the pods in our cluster, and
another to use for the services in our cluster.</p>
</div>
<div class="paragraph">
<p>The default pod subnet that the <a href="https://github.com/flannel-io/flannel">Flannel CNI</a> uses
is <strong>10.244.0.0/16</strong>.</p>
</div>
<div class="paragraph">
<p>The default service subnet that Kubernetes uses is <strong>10.96.0.0/12</strong>.
We&#8217;ll be using these for our examples going forward.</p>
</div>
<div class="paragraph">
<p><strong>Proxies</strong>:</p>
</div>
<div class="paragraph">
<p>Set up DNF HPE proxy so we can download things with DNF from the internet.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cat &gt;&gt; /etc/dnf/dnf.conf &lt;&lt; EOF
[main]
gpgcheck=0
installonly_limit=3
clean_requirements_on_remove=True
best=True
skip_if_unavailable=False
proxy=http://proxy.houston.hpecorp.net:8080
EOF</code></pre>
</div>
</div>
<div class="paragraph">
<p>Set up HTTP HPE proxy so we can download things with <code>wget</code>, etc, from the internet.
We&#8217;ll need to disable this later on when setting up kubernetes; otherwise internal
requests will try to use the proxy and will fail. <code>kubeadm</code> will also try to download
things from the internet, so having the correct proxy environment set is critical.
We&#8217;ll need to make sure we <em>don&#8217;t</em> use a proxy for our pod subnet, our lab network subnet,
or the service API subnet for kubernetes, so add those to the <code>no_proxy</code> section.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cat &gt;&gt; /etc/environment &lt;&lt; EOF
http_proxy="http://proxy.houston.hpecorp.net:8080/"
https_proxy="http://proxy.houston.hpecorp.net:8080/"
ftp_proxy="http://proxy.houston.hpecorp.net:8080/"
no_proxy="localhost,127.0.0.1,hpc.amslabs.hpecorp.net,10.214.128.0/21,10.96.0.0/12,10.244.0.0/16"
EOF</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Install utilities</strong>:</p>
</div>
<div class="paragraph">
<p>Upgrade as many packages, and the kernel with DNF as we can before we get started:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">dnf -y upgrade</code></pre>
</div>
</div>
<div class="paragraph">
<p>Download basic CLI utilities</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">dnf -y install wget curl vim openssl git tar conntrack-tools socat</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_enable_ipv4_forwarding"><a class="anchor" href="#_enable_ipv4_forwarding"></a>Enable IPv4 forwarding</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">modprobe bridge
modprobe br_netfilter
echo "net.bridge.bridge-nf-call-iptables = 1" &gt;&gt; /etc/sysctl.conf
sysctl -p /etc/sysctl.conf
echo 1 | sudo tee /proc/sys/net/ipv4/ip_forward</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_disable_firewalld"><a class="anchor" href="#_disable_firewalld"></a>Disable firewalld</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">systemctl stop firewalld
systemctl disable firewalld</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note: I don&#8217;t recommend doing this in a production cluster. This is only to simplify things for this dev cluster.</p>
</div>
</div>
<div class="sect2">
<h3 id="_disable_swap"><a class="anchor" href="#_disable_swap"></a>Disable swap</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash"># This only disables swap for the current session.
swapoff -a

# This will find any lines in /etc/fstab with 'swap' and comment them out
sed -i.bak '/ swap / s/^\(.*\)$/#\1/g' /etc/fstab</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_disable_selinux"><a class="anchor" href="#_disable_selinux"></a>Disable SELinux</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">setenforce 0
sed -i 's/^SELINUX=enforcing$/SELINUX=disabled/' /etc/selinux/config</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note: I don&#8217;t recommend doing this in a production cluster. This is only to simplify things for this dev cluster.</p>
</div>
</div>
<div class="sect2">
<h3 id="_install_containerd_cni_plugin_and_runc"><a class="anchor" href="#_install_containerd_cni_plugin_and_runc"></a>Install containerd, CNI plugin, and runc</h3>
<div class="paragraph">
<p><a href="https://github.com/containerd/containerd/blob/main/docs/getting-started.md" class="bare">https://github.com/containerd/containerd/blob/main/docs/getting-started.md</a></p>
</div>
<div class="paragraph">
<p>This step will also install <code>runc.amd64</code> and CNI plugins.</p>
</div>
<div class="listingblock">
<div class="title">download.sh</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">#!/bin/bash

# https://github.com/opencontainers/runc/releases
RUNC_VERSION="v1.3.0"

# https://github.com/kubernetes-sigs/cri-tools/releases
CRI_TOOLS_VERSION="v1.33.0"

# https://github.com/containernetworking/plugins/releases
CNI_PLUGINS_VERSION="v1.7.1"

# https://github.com/containerd/containerd/releases
CONTAINERD_VERSION="2.1.4"

download_urls=(
	https://github.com/kubernetes-sigs/cri-tools/releases/download/$CRI_TOOLS_VERSION/crictl-$CRI_TOOLS_VERSION-linux-amd64.tar.gz
	https://github.com/opencontainers/runc/releases/download/$RUNC_VERSION/runc.amd64
	https://github.com/containernetworking/plugins/releases/download/$CNI_PLUGINS_VERSION/cni-plugins-linux-amd64-$CNI_PLUGINS_VERSION.tgz
	https://github.com/containerd/containerd/releases/download/v$CONTAINERD_VERSION/containerd-$CONTAINERD_VERSION-linux-amd64.tar.gz
)

for download_url in "${download_urls[@]}"; do
	wget -q --show-progress  --https-only --timestamping "$download_url"
done</code></pre>
</div>
</div>
<div class="paragraph">
<p>Extract containerd tarball to <code>/usr/local</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">tar Cxzvf /usr/local containerd-*-linux-amd64.tar.gz</code></pre>
</div>
</div>
<div class="paragraph">
<p>We&#8217;ll be running containerd with systemd. This unit file can be found here, and
the below example uses modifications to the environment variables for the service
to use the HPE proxy. This will allow the containerd runtime to pull images from
outside the lab.</p>
</div>
<div class="paragraph">
<p>Generate a default containerd configuration file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mkdir /etc/containerd
containerd config default &gt; /etc/containerd/config.toml</code></pre>
</div>
</div>
<div class="paragraph">
<p>Edit this file and add systemd as the cgroup driver for containerd.
<a href="https://kubernetes.io/docs/setup/production-environment/container-runtimes/#containerd-systemd" class="bare">https://kubernetes.io/docs/setup/production-environment/container-runtimes/#containerd-systemd</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-plaintext hljs" data-lang="plaintext">[plugins.'io.containerd.cri.v1.runtime'.containerd.runtimes.runc]
  ...
  [plugins.'io.containerd.cri.v1.runtime'.containerd.runtimes.runc.options]
    SystemdCgroup = true</code></pre>
</div>
</div>
<div class="paragraph">
<p>Install <code>runc.amd64</code>. This should have been downloaded from the <code>download.sh</code> script before, but if not,
you can get it from <a href="https://github.com/opencontainers/runc/releases" class="bare">https://github.com/opencontainers/runc/releases</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">install -m 755 runc.amd64 /usr/local/sbin/runc</code></pre>
</div>
</div>
<div class="paragraph">
<p>Install CNI plugins. This should have been downloaded from the <code>download.sh</code> script before, but if not,
you can get it from <a href="https://github.com/containernetworking/plugins/releases" class="bare">https://github.com/containernetworking/plugins/releases</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mkdir -p /opt/cni/bin
tar Cxzvf /opt/cni/bin cni-plugins-linux-amd64-v*.tgz</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">/usr/lib/systemd/system/containerd.service</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-plaintext hljs" data-lang="plaintext">[Unit]
Description=containerd container runtime
Documentation=https://containerd.io
After=network.target dbus.service

[Service]
Environment="HTTP_PROXY=http://proxy.houston.hpecorp.net:8080/"
Environment="HTTPS_PROXY=http://proxy.houston.hpecorp.net:8080/"
Environment="FTP_PROXY=http://proxy.houston.hpecorp.net:8080/"
Environment="NO_PROXY=localhost,127.0.0.1,.us.cray.com,.hpe.com,hpc.amslabs.hpecorp.net,10.214.128.0/21,10.96.0.0/12,10.244.0.0/16"
ExecStartPre=-/sbin/modprobe overlay
ExecStart=/usr/local/bin/containerd

Type=notify
Delegate=yes
KillMode=process
Restart=always
RestartSec=5

# Having non-zero Limit*s causes performance problems due to accounting overhead
# in the kernel. We recommend using cgroups to do container-local accounting.
LimitNPROC=infinity
LimitCORE=infinity

# Comment TasksMax if your systemd version does not supports it.
# Only systemd 226 and above support this version.
TasksMax=infinity
OOMScoreAdjust=-999

[Install]
WantedBy=multi-user.target</code></pre>
</div>
</div>
<div class="paragraph">
<p>With this in place, enable and load containerd with systemd:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">systemctl daemon-reload
systemctl enable --now containerd</code></pre>
</div>
</div>
<div class="paragraph">
<p>Check the status. It should look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">[root@mawenzi-01 downloads]# systemctl status containerd
● containerd.service - containerd container runtime
     Loaded: loaded (/usr/lib/systemd/system/containerd.service; enabled; preset: disabled)
     Active: active (running) since Tue 2025-08-26 10:31:12 MDT; 3s ago
       Docs: https://containerd.io
    Process: 117075 ExecStartPre=/sbin/modprobe overlay (code=exited, status=0/SUCCESS)
   Main PID: 117077 (containerd)
      Tasks: 17
     Memory: 36.2M
        CPU: 194ms
     CGroup: /system.slice/containerd.service
             └─117077 /usr/local/bin/containerd

Aug 26 10:31:12 mawenzi-01 containerd[117077]: time="2025-08-26T10:31:12.426293642-06:00" level=info msg=serving... address=/run/containerd/containerd.sock.ttrpc
Aug 26 10:31:12 mawenzi-01 containerd[117077]: time="2025-08-26T10:31:12.426334788-06:00" level=info msg="Start cni network conf syncer for default"
Aug 26 10:31:12 mawenzi-01 containerd[117077]: time="2025-08-26T10:31:12.426447839-06:00" level=info msg=serving... address=/run/containerd/containerd.sock
Aug 26 10:31:12 mawenzi-01 containerd[117077]: time="2025-08-26T10:31:12.426473006-06:00" level=info msg="Start streaming server"
Aug 26 10:31:12 mawenzi-01 containerd[117077]: time="2025-08-26T10:31:12.426507981-06:00" level=info msg="Registered namespace \"k8s.io\" with NRI"
Aug 26 10:31:12 mawenzi-01 containerd[117077]: time="2025-08-26T10:31:12.426545321-06:00" level=info msg="runtime interface starting up..."
Aug 26 10:31:12 mawenzi-01 containerd[117077]: time="2025-08-26T10:31:12.426564517-06:00" level=info msg="starting plugins..."
Aug 26 10:31:12 mawenzi-01 containerd[117077]: time="2025-08-26T10:31:12.426601917-06:00" level=info msg="Synchronizing NRI (plugin) with current runtime state"
Aug 26 10:31:12 mawenzi-01 containerd[117077]: time="2025-08-26T10:31:12.427695697-06:00" level=info msg="containerd successfully booted in 0.121902s"
Aug 26 10:31:12 mawenzi-01 systemd[1]: Started containerd container runtime.</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_install_kubernetes_packages"><a class="anchor" href="#_install_kubernetes_packages"></a>Install Kubernetes packages</h3>
<div class="paragraph">
<p>This gets us <code>kubeadm</code>, <code>kubectl</code>, and <code>kubelet</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cat &lt;&lt;EOF | sudo tee /etc/yum.repos.d/kubernetes.repo
[kubernetes]
name=Kubernetes
baseurl=https://pkgs.k8s.io/core:/stable:/v1.33/rpm/
enabled=1
gpgcheck=1
gpgkey=https://pkgs.k8s.io/core:/stable:/v1.33/rpm/repodata/repomd.xml.key
exclude=kubelet kubeadm kubectl cri-tools kubernetes-cni
EOF

dnf install -y kubelet kubeadm kubectl --disableexcludes=kubernetes</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_enable_kubelet_systemd_service"><a class="anchor" href="#_enable_kubelet_systemd_service"></a>Enable kubelet systemd service</h3>
<div class="paragraph">
<p>Enable the kubelet service.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">systemctl enable --now kubelet</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note: If you check the status of the kubelet service (<code>systemctl status kubelet</code>), you&#8217;ll see that it&#8217;s
exiting with code <code>FAILURE</code>. This is normal. It&#8217;s restarting every few seconds, while we wait for <code>kubeadm</code>
to tell it what to do.</p>
</div>
</div>
<div class="sect2">
<h3 id="_using_kubeadm_to_init_cluster"><a class="anchor" href="#_using_kubeadm_to_init_cluster"></a>Using kubeadm to init cluster</h3>
<div class="paragraph">
<p><a href="https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/create-cluster-kubeadm/" class="bare">https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/create-cluster-kubeadm/</a></p>
</div>
<div class="paragraph">
<p>On the control-plane node, initialize the cluster with the following args:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>--node-name</code>: this will ensure that our control-plane&#8217;s hostname will have an entry in the certificates that get generated.</p>
</li>
<li>
<p><code>--pod-network-cidr</code>: this must match the Pod subnet we&#8217;ll use with the Flannel CNI. This is Flannel&#8217;s default.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">kubeadm init --pod-network-cidr 10.244.0.0/16 --node-name mawenzi-01</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">[root@mawenzi-01 ~]# https_proxy=http://proxy.houston.hpecorp.net:8080 no_proxy="localhost,127.0.0.1,hpc.amslabs.hpecorp.net,10.214.128.0/21,10.96.0.0/12,10.244.0.0/16" kubeadm init --pod-network-cidr 10.244.0.0/16 --node-name mawenzi-01
I0827 16:25:40.233312   14045 version.go:261] remote version is much newer: v1.34.0; falling back to: stable-1.33
[init] Using Kubernetes version: v1.33.4
[preflight] Running pre-flight checks
[preflight] Pulling images required for setting up a Kubernetes cluster
[preflight] This might take a minute or two, depending on the speed of your internet connection
[preflight] You can also perform this action beforehand using 'kubeadm config images pull'
[certs] Using certificateDir folder "/etc/kubernetes/pki"
[certs] Generating "ca" certificate and key
[certs] Generating "apiserver" certificate and key
[certs] apiserver serving cert is signed for DNS names [kubernetes kubernetes.default kubernetes.default.svc kubernetes.default.svc.cluster.local mawenzi-01] and IPs [10.96.0.1 10.214.134.147]
[certs] Generating "apiserver-kubelet-client" certificate and key
[certs] Generating "front-proxy-ca" certificate and key
[certs] Generating "front-proxy-client" certificate and key
[certs] Generating "etcd/ca" certificate and key
[certs] Generating "etcd/server" certificate and key
[certs] etcd/server serving cert is signed for DNS names [localhost mawenzi-01] and IPs [10.214.134.147 127.0.0.1 ::1]
[certs] Generating "etcd/peer" certificate and key
[certs] etcd/peer serving cert is signed for DNS names [localhost mawenzi-01] and IPs [10.214.134.147 127.0.0.1 ::1]
[certs] Generating "etcd/healthcheck-client" certificate and key
[certs] Generating "apiserver-etcd-client" certificate and key
[certs] Generating "sa" key and public key
[kubeconfig] Using kubeconfig folder "/etc/kubernetes"
[kubeconfig] Writing "admin.conf" kubeconfig file
[kubeconfig] Writing "super-admin.conf" kubeconfig file
[kubeconfig] Writing "kubelet.conf" kubeconfig file
[kubeconfig] Writing "controller-manager.conf" kubeconfig file
[kubeconfig] Writing "scheduler.conf" kubeconfig file
[etcd] Creating static Pod manifest for local etcd in "/etc/kubernetes/manifests"
[control-plane] Using manifest folder "/etc/kubernetes/manifests"
[control-plane] Creating static Pod manifest for "kube-apiserver"
[control-plane] Creating static Pod manifest for "kube-controller-manager"
[control-plane] Creating static Pod manifest for "kube-scheduler"
[kubelet-start] Writing kubelet environment file with flags to file "/var/lib/kubelet/kubeadm-flags.env"
[kubelet-start] Writing kubelet configuration to file "/var/lib/kubelet/config.yaml"
[kubelet-start] Starting the kubelet
[wait-control-plane] Waiting for the kubelet to boot up the control plane as static Pods from directory "/etc/kubernetes/manifests"
[kubelet-check] Waiting for a healthy kubelet at http://127.0.0.1:10248/healthz. This can take up to 4m0s
[kubelet-check] The kubelet is healthy after 1.501224529s
[control-plane-check] Waiting for healthy control plane components. This can take up to 4m0s
[control-plane-check] Checking kube-apiserver at https://10.214.134.147:6443/livez
[control-plane-check] Checking kube-controller-manager at https://127.0.0.1:10257/healthz
[control-plane-check] Checking kube-scheduler at https://127.0.0.1:10259/livez
[control-plane-check] kube-scheduler is healthy after 2.718165783s
[control-plane-check] kube-controller-manager is healthy after 4.187683893s
[control-plane-check] kube-apiserver is healthy after 4.501363588s
[upload-config] Storing the configuration used in ConfigMap "kubeadm-config" in the "kube-system" Namespace
[kubelet] Creating a ConfigMap "kubelet-config" in namespace kube-system with the configuration for the kubelets in the cluster
[upload-certs] Skipping phase. Please see --upload-certs
[mark-control-plane] Marking the node mawenzi-01 as control-plane by adding the labels: [node-role.kubernetes.io/control-plane node.kubernetes.io/exclude-from-external-load-balancers]
[mark-control-plane] Marking the node mawenzi-01 as control-plane by adding the taints [node-role.kubernetes.io/control-plane:NoSchedule]
[bootstrap-token] Using token: ano6ya.1nfsxs6sv96a2mvv
[bootstrap-token] Configuring bootstrap tokens, cluster-info ConfigMap, RBAC Roles
[bootstrap-token] Configured RBAC rules to allow Node Bootstrap tokens to get nodes
[bootstrap-token] Configured RBAC rules to allow Node Bootstrap tokens to post CSRs in order for nodes to get long term certificate credentials
[bootstrap-token] Configured RBAC rules to allow the csrapprover controller automatically approve CSRs from a Node Bootstrap Token
[bootstrap-token] Configured RBAC rules to allow certificate rotation for all node client certificates in the cluster
[bootstrap-token] Creating the "cluster-info" ConfigMap in the "kube-public" namespace
[kubelet-finalize] Updating "/etc/kubernetes/kubelet.conf" to point to a rotatable kubelet client certificate and key
[addons] Applied essential addon: CoreDNS
[addons] Applied essential addon: kube-proxy

Your Kubernetes control-plane has initialized successfully!

To start using your cluster, you need to run the following as a regular user:

  mkdir -p $HOME/.kube
  sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
  sudo chown $(id -u):$(id -g) $HOME/.kube/config

Alternatively, if you are the root user, you can run:

  export KUBECONFIG=/etc/kubernetes/admin.conf

You should now deploy a pod network to the cluster.
Run "kubectl apply -f [podnetwork].yaml" with one of the options listed at:
  https://kubernetes.io/docs/concepts/cluster-administration/addons/

Then you can join any number of worker nodes by running the following on each as root:

kubeadm join 10.214.134.147:6443 --token ano6ya.1nfsxs6....a2mvv \
	--discovery-token-ca-cert-hash sha256:66077c37436bc739bdd55238bda....31e57fbd42c64f482d0ca9e86a62f1ab</code></pre>
</div>
</div>
<div class="paragraph">
<p>Save the output, particularly the <code>kubeadm join</code> command, to a text file. We&#8217;ll use it later.</p>
</div>
<div class="paragraph">
<p>Next, run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mkdir -p $HOME/.kube
cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
chown $(id -u):$(id -g) $HOME/.kube/config
export KUBECONFIG=/etc/kubernetes/admin.conf</code></pre>
</div>
</div>
<div class="paragraph">
<p>And add this to your <code>~/.bashrc</code> or <code>~/.zshrc</code> file: <code>export KUBECONFIG=/etc/kubernetes/admin.conf</code></p>
</div>
<div class="paragraph">
<p>You should now be able to see that <code>systemctl status kubelet</code> is reporting Active/Running and should be
relatively healthy.</p>
</div>
</div>
<div class="sect2">
<h3 id="_installing_flannel_cni"><a class="anchor" href="#_installing_flannel_cni"></a>Installing Flannel CNI</h3>
<div class="paragraph">
<p>We&#8217;ll now need to install a CNI so we have the host-to-pod networking layer available. The CNI
is what&#8217;s responsible for configuring network interfaces for Linux containers, assigning IPs
to pods, etc.</p>
</div>
<div class="paragraph">
<p>Without this, pods have no way of communicating with each other, and this is a critical step in
getting a cluster running.</p>
</div>
<div class="paragraph">
<p>We&#8217;ll be using <a href="https://github.com/flannel-io/flannel">Flannel CNI</a> for this. Since we used the default Pod CIDR for
Flannel in our <code>kubeadm init</code> command, we can just use the default set of Flannel CRDs:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">kubectl apply -f https://github.com/flannel-io/flannel/releases/latest/download/kube-flannel.yml</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">serviceaccount/flannel created
clusterrole.rbac.authorization.k8s.io/flannel created
clusterrolebinding.rbac.authorization.k8s.io/flannel created
configmap/kube-flannel-cfg created
daemonset.apps/kube-flannel-ds created</code></pre>
</div>
</div>
<div class="paragraph">
<p>This creates a Flannel <code>ServiceAccount</code>, RBAC CRDs, <code>ConfigMap</code>, and a <code>DaemonSet</code>.
The <code>DaemonSet</code> will run a Flannel pod on every node in the cluster, which will be
responsible for managing that node&#8217;s networking.</p>
</div>
<div class="paragraph">
<p>Check the nodes and pods for the cluster now:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">[root@mawenzi-01 ~]# kubectl get nodes
NAME         STATUS   ROLES           AGE     VERSION
mawenzi-01   Ready    control-plane   5h13m   v1.33.4

[root@mawenzi-01 ~]# kubectl get pods -A
NAMESPACE      NAME                                 READY   STATUS    RESTARTS   AGE
kube-flannel   kube-flannel-ds-4482d                1/1     Running   0          5h11m
kube-system    coredns-674b8bbfcf-hlgg8             1/1     Running   0          5h11m
kube-system    coredns-674b8bbfcf-nk92m             1/1     Running   0          5h11m
kube-system    etcd-mawenzi-01                      1/1     Running   6          5h11m
kube-system    kube-apiserver-mawenzi-01            1/1     Running   1          5h11m
kube-system    kube-controller-manager-mawenzi-01   1/1     Running   1          5h11m
kube-system    kube-proxy-7mb9w                     1/1     Running   0          5h11m
kube-system    kube-scheduler-mawenzi-01            1/1     Running   1          5h11m</code></pre>
</div>
</div>
<div class="paragraph">
<p>Nodes are now ready to join the cluster!</p>
</div>
<div class="paragraph">
<p>At this point, I&#8217;d recommend setting up password-less SSH to the nodes in your cluster to make your life easier,
before moving on to setting up those nodes.</p>
</div>
</div>
<div class="sect2">
<h3 id="_set_up_worker_nodes_ssh_access"><a class="anchor" href="#_set_up_worker_nodes_ssh_access"></a>Set up worker nodes SSH access</h3>
<div class="paragraph">
<p>With a blank install, you won&#8217;t have any SSH keys generated:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">[root@mawenzi-01 kubernetes]# ls -la ~/.ssh
total 16
drwx------. 2 root root   71 Aug 22 11:57 .
dr-xr-x---. 5 root root 4096 Aug 22 11:53 ..
-rw-------. 1 root root  195 Aug 22 10:02 authorized_keys
-rw-------. 1 root root  828 Aug 22 11:57 known_hosts
-rw-r--r--. 1 root root   92 Aug 22 11:57 known_hosts.old</code></pre>
</div>
</div>
<div class="paragraph">
<p>Use <code>ssh-keygen</code> to generate a public/private key pair.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">[root@mawenzi-01 kubernetes]# ssh-keygen
Generating public/private rsa key pair.
Enter file in which to save the key (/root/.ssh/id_rsa):
Enter passphrase (empty for no passphrase):
Enter same passphrase again:
Your identification has been saved in /root/.ssh/id_rsa
Your public key has been saved in /root/.ssh/id_rsa.pub
The key fingerprint is:
SHA256:QxH4vc8bmPmzyAKa+HPk0nUsnRPdXIf51fBJx98zO0c root@mawenzi-01
The key's randomart image is:
+---[RSA 3072]----+
|       .o.    .*o|
|      .  .    +.O|
|       ... . o +*|
|       .. o . ooE|
|        So +   .+|
|      o o.B+   o.|
|   . * o o++.   o|
|  . = + .. o+.   |
|   ..+   .o ++   |
+----[SHA256]-----+</code></pre>
</div>
</div>
<div class="paragraph">
<p>Copy the public key to each node in your cluster.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">ssh-copy-id root@${IP}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_joining_nodes_to_the_cluster"><a class="anchor" href="#_joining_nodes_to_the_cluster"></a>Joining Nodes to the Cluster</h3>
<div class="paragraph">
<p>Every node in the cluster will have to have the same steps done to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Set proxies; dnf configuration</p>
</li>
<li>
<p>Install basic dependencies</p>
</li>
<li>
<p>Disable swap</p>
</li>
<li>
<p>Disable firewalls and SELinux, open ports</p>
</li>
<li>
<p>Enable port forwarding, bridge networks, etc</p>
</li>
<li>
<p>Install containerd, runc, CNI plugins</p>
<div class="ulist">
<ul>
<li>
<p>Configure containerd to use systemd as cgroup manager</p>
</li>
<li>
<p>Run containerd with systemd, using appropriate service file</p>
</li>
</ul>
</div>
</li>
<li>
<p>Install kubelet, kubectl, and kubeadm</p>
<div class="ulist">
<ul>
<li>
<p>Run kubelet with systemd</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>You&#8217;ll follow all the same steps from <a href="#_prerequisites">Prerequisites</a> up until
<a href="#_using_kubeadm_to_init_cluster">Using kubeadm to init cluster</a> to prepare a worker node.</p>
</div>
<div class="paragraph">
<p>Taking the output from the original <code>kubeadm init</code> command, which you should have saved to a file,
run the <code>kubeadm join</code> command with the token.</p>
</div>
<div class="listingblock">
<div class="title">Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">[root@mawenzi-02 ~]# kubeadm join 10.214.134.147:6443 --token ano6ya.1nfs......6a2mvv \
        --discovery-token-ca-cert-hash sha256:66077c37436bc739bdd55238.....e8e31e57fbd42c64f482d0ca9e86a62f1ab
[preflight] Running pre-flight checks
[preflight] Reading configuration from the "kubeadm-config" ConfigMap in namespace "kube-system"...
[preflight] Use 'kubeadm init phase upload-config --config your-config-file' to re-upload it.
[kubelet-start] Writing kubelet configuration to file "/var/lib/kubelet/config.yaml"
[kubelet-start] Writing kubelet environment file with flags to file "/var/lib/kubelet/kubeadm-flags.env"
[kubelet-start] Starting the kubelet
[kubelet-check] Waiting for a healthy kubelet at http://127.0.0.1:10248/healthz. This can take up to 4m0s
[kubelet-check] The kubelet is healthy after 501.800726ms
[kubelet-start] Waiting for the kubelet to perform the TLS Bootstrap

This node has joined the cluster:
* Certificate signing request was sent to apiserver and a response was received.
* The Kubelet was informed of the new secure connection details.

Run 'kubectl get nodes' on the control-plane to see this node join the cluster.</code></pre>
</div>
</div>
<div class="paragraph">
<p>On the control-plane node, run <code>kubectl get nodes</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">[root@mawenzi-01 ~]# kubectl get nodes
NAME         STATUS   ROLES           AGE     VERSION
mawenzi-01   Ready    control-plane   5h24m   v1.33.4
mawenzi-02   Ready    &lt;none&gt;          29m     v1.33.4</code></pre>
</div>
</div>
<div class="paragraph">
<p>We&#8217;ve got a new node in our cluster!
You should also see an instance of <code>kube-proxy</code>, and <code>kube-flannel</code> running on the node:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">[root@mawenzi-01 ~]# kubectl get pods -A -o wide | grep mawenzi-02
kube-flannel   kube-flannel-ds-cdw8t                1/1     Running   0          30m     10.214.130.159   mawenzi-02   &lt;none&gt;           &lt;none&gt;
kube-system    kube-proxy-826t2                     1/1     Running   0          30m     10.214.130.159   mawenzi-02   &lt;none&gt;           &lt;none&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, rinse and repeat for the rest of the nodes:</p>
</div>
<div class="paragraph">
<p>&#8230;&#8203;</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">[root@mawenzi-01 ~]# kubectl get nodes
NAME         STATUS   ROLES           AGE     VERSION
mawenzi-01   Ready    control-plane   5h31m   v1.33.4
mawenzi-02   Ready    &lt;none&gt;          35m     v1.33.4
mawenzi-03   Ready    &lt;none&gt;          21s     v1.33.4</code></pre>
</div>
</div>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <p>Copyright © 2023-2025 Caleb Carlson. All rights reserved.
</footer>
<script id="site-script" src="../../../../_/js/site.js" data-ui-root-path="../../../../_"></script>
<script async src="../../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
